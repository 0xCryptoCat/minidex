{
    "sourceFile": "src/features/search/SearchInput.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 25,
            "patches": [
                {
                    "date": 1755347748704,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1755356506679,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -154,8 +154,11 @@\n           ...(query ? {\n             borderColor: 'var(--telegram-blue)',\n             background: 'var(--bg-elev)',\n           } : {}),\n+          ...((results.length > 0 || isLoading) ? {\n+            borderRadius: large ? 'var(--radius-pill) var(--radius-pill) 0 0' : 'var(--radius-pill) var(--radius-pill) 0 0'\n+          } : {})\n         }}\n       />\n       \n       {(results.length > 0 || isLoading) && (\n"
                },
                {
                    "date": 1755361663381,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -155,9 +155,10 @@\n             borderColor: 'var(--telegram-blue)',\n             background: 'var(--bg-elev)',\n           } : {}),\n           ...((results.length > 0 || isLoading) ? {\n-            borderRadius: large ? 'var(--radius-pill) var(--radius-pill) 0 0' : 'var(--radius-pill) var(--radius-pill) 0 0'\n+            borderBottomLeftRadius: 0,\n+            borderBottomRightRadius: 0\n           } : {})\n         }}\n       />\n       \n"
                },
                {
                    "date": 1755429090624,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -114,9 +114,9 @@\n   };\n \n   const inputStyle = large ? {\n     width: '100%',\n-    fontSize: '1.125rem',\n+    fontSize: '1rem',\n     padding: 'var(--space-4)',\n     borderRadius: 'var(--radius-pill)',\n     background: 'var(--bg-input)',\n     border: '1px solid var(--border)',\n"
                },
                {
                    "date": 1755429099227,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -155,8 +155,9 @@\n             borderColor: 'var(--telegram-blue)',\n             background: 'var(--bg-elev)',\n           } : {}),\n           ...((results.length > 0 || isLoading) ? {\n+            \n             borderBottomLeftRadius: 0,\n             borderBottomRightRadius: 0\n           } : {})\n         }}\n"
                },
                {
                    "date": 1755429106060,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -155,9 +155,10 @@\n             borderColor: 'var(--telegram-blue)',\n             background: 'var(--bg-elev)',\n           } : {}),\n           ...((results.length > 0 || isLoading) ? {\n-            \n+            borderTopLeftRadius: 'var(--radius-pill)',\n+            borderTopRightRadius: 'var(--radius-pill)',\n             borderBottomLeftRadius: 0,\n             borderBottomRightRadius: 0\n           } : {})\n         }}\n"
                },
                {
                    "date": 1755429154996,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -155,10 +155,9 @@\n             borderColor: 'var(--telegram-blue)',\n             background: 'var(--bg-elev)',\n           } : {}),\n           ...((results.length > 0 || isLoading) ? {\n-            borderTopLeftRadius: 'var(--radius-pill)',\n-            borderTopRightRadius: 'var(--radius-pill)',\n+            \n             borderBottomLeftRadius: 0,\n             borderBottomRightRadius: 0\n           } : {})\n         }}\n"
                },
                {
                    "date": 1755429177979,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -155,9 +155,8 @@\n             borderColor: 'var(--telegram-blue)',\n             background: 'var(--bg-elev)',\n           } : {}),\n           ...((results.length > 0 || isLoading) ? {\n-            \n             borderBottomLeftRadius: 0,\n             borderBottomRightRadius: 0\n           } : {})\n         }}\n"
                },
                {
                    "date": 1755429234507,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -116,9 +116,9 @@\n   const inputStyle = large ? {\n     width: '100%',\n     fontSize: '1rem',\n     padding: 'var(--space-4)',\n-    borderRadius: 'var(--radius-pill)',\n+    borderRadius: '25px,\n     background: 'var(--bg-input)',\n     border: '1px solid var(--border)',\n     color: 'var(--text)',\n     transition: 'all var(--transition-fast)',\n"
                },
                {
                    "date": 1755429269137,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -116,9 +116,9 @@\n   const inputStyle = large ? {\n     width: '100%',\n     fontSize: '1rem',\n     padding: 'var(--space-4)',\n-    borderRadius: '25px,\n+    borderRadius: '25px', //\n     background: 'var(--bg-input)',\n     border: '1px solid var(--border)',\n     color: 'var(--text)',\n     transition: 'all var(--transition-fast)',\n"
                },
                {
                    "date": 1755429286435,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -116,9 +116,10 @@\n   const inputStyle = large ? {\n     width: '100%',\n     fontSize: '1rem',\n     padding: 'var(--space-4)',\n-    borderRadius: '25px', //\n+    borderRadius: '25px', // smaller radius for large input\n+    borderBottomLeftRadius\n     background: 'var(--bg-input)',\n     border: '1px solid var(--border)',\n     color: 'var(--text)',\n     transition: 'all var(--transition-fast)',\n"
                },
                {
                    "date": 1755429315982,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -117,9 +117,9 @@\n     width: '100%',\n     fontSize: '1rem',\n     padding: 'var(--space-4)',\n     borderRadius: '25px', // smaller radius for large input\n-    borderBottomLeftRadius\n+    \n     background: 'var(--bg-input)',\n     border: '1px solid var(--border)',\n     color: 'var(--text)',\n     transition: 'all var(--transition-fast)',\n"
                },
                {
                    "date": 1755429326011,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -116,10 +116,9 @@\n   const inputStyle = large ? {\n     width: '100%',\n     fontSize: '1rem',\n     padding: 'var(--space-4)',\n-    borderRadius: '25px', // smaller radius for large input\n-    \n+    borderRadius: 'var(--radius-pill)',\n     background: 'var(--bg-input)',\n     border: '1px solid var(--border)',\n     color: 'var(--text)',\n     transition: 'all var(--transition-fast)',\n"
                },
                {
                    "date": 1755429334881,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -126,9 +126,9 @@\n   } : {\n     width: '100%',\n     fontSize: '1rem',\n     padding: 'var(--space-3)',\n-    borderRadius: 'var(--radius-pill)',\n+    borderRadius: '25px',\n     background: 'var(--bg-input)',\n     border: '1px solid var(--border)',\n     color: 'var(--text)',\n     transition: 'all var(--transition-fast)',\n"
                },
                {
                    "date": 1755429350491,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -127,8 +127,9 @@\n     width: '100%',\n     fontSize: '1rem',\n     padding: 'var(--space-3)',\n     borderRadius: '25px',\n+    \n     background: 'var(--bg-input)',\n     border: '1px solid var(--border)',\n     color: 'var(--text)',\n     transition: 'all var(--transition-fast)',\n"
                },
                {
                    "date": 1755429365002,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -127,9 +127,9 @@\n     width: '100%',\n     fontSize: '1rem',\n     padding: 'var(--space-3)',\n     borderRadius: '25px',\n-    \n+\n     background: 'var(--bg-input)',\n     border: '1px solid var(--border)',\n     color: 'var(--text)',\n     transition: 'all var(--transition-fast)',\n"
                },
                {
                    "date": 1755429370713,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -126,10 +126,9 @@\n   } : {\n     width: '100%',\n     fontSize: '1rem',\n     padding: 'var(--space-3)',\n-    borderRadius: '25px',\n-\n+    borderRadius: 'var(--radius)',\n     background: 'var(--bg-input)',\n     border: '1px solid var(--border)',\n     color: 'var(--text)',\n     transition: 'all var(--transition-fast)',\n"
                },
                {
                    "date": 1755429390031,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -126,9 +126,9 @@\n   } : {\n     width: '100%',\n     fontSize: '1rem',\n     padding: 'var(--space-3)',\n-    borderRadius: 'var(--radius)',\n+    borderRadius: 'var(--radius-pill)',\n     background: 'var(--bg-input)',\n     border: '1px solid var(--border)',\n     color: 'var(--text)',\n     transition: 'all var(--transition-fast)',\n@@ -155,8 +155,9 @@\n             borderColor: 'var(--telegram-blue)',\n             background: 'var(--bg-elev)',\n           } : {}),\n           ...((results.length > 0 || isLoading) ? {\n+            \n             borderBottomLeftRadius: 0,\n             borderBottomRightRadius: 0\n           } : {})\n         }}\n"
                },
                {
                    "date": 1755429397073,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -155,9 +155,9 @@\n             borderColor: 'var(--telegram-blue)',\n             background: 'var(--bg-elev)',\n           } : {}),\n           ...((results.length > 0 || isLoading) ? {\n-            \n+            borderRadius: 'var(--radius) var(--radius) 0 0',\n             borderBottomLeftRadius: 0,\n             borderBottomRightRadius: 0\n           } : {})\n         }}\n"
                },
                {
                    "date": 1755440701874,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -117,9 +117,9 @@\n     width: '100%',\n     fontSize: '1rem',\n     padding: 'var(--space-4)',\n     borderRadius: 'var(--radius-pill)',\n-    background: 'var(--bg-input)',\n+    background: 'var(--bg)',\n     border: '1px solid var(--border)',\n     color: 'var(--text)',\n     transition: 'all var(--transition-fast)',\n     outline: 'none',\n@@ -156,10 +156,8 @@\n             background: 'var(--bg-elev)',\n           } : {}),\n           ...((results.length > 0 || isLoading) ? {\n             borderRadius: 'var(--radius) var(--radius) 0 0',\n-            borderBottomLeftRadius: 0,\n-            borderBottomRightRadius: 0\n           } : {})\n         }}\n       />\n       \n"
                },
                {
                    "date": 1755440708447,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -119,17 +119,17 @@\n     padding: 'var(--space-4)',\n     borderRadius: 'var(--radius-pill)',\n     background: 'var(--bg)',\n     border: '1px solid var(--border)',\n-    color: 'var(--text)',\n+    color: 'var(--text-muted)',\n     transition: 'all var(--transition-fast)',\n     outline: 'none',\n   } : {\n     width: '100%',\n     fontSize: '1rem',\n     padding: 'var(--space-3)',\n     borderRadius: 'var(--radius-pill)',\n-    background: 'var(--bg-input)',\n+    background: 'var(--bg)',\n     border: '1px solid var(--border)',\n     color: 'var(--text)',\n     transition: 'all var(--transition-fast)',\n     outline: 'none',\n"
                },
                {
                    "date": 1755440714754,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -129,9 +129,9 @@\n     padding: 'var(--space-3)',\n     borderRadius: 'var(--radius-pill)',\n     background: 'var(--bg)',\n     border: '1px solid var(--border)',\n-    color: 'var(--text)',\n+    color: 'var(--text-muted)',\n     transition: 'all var(--transition-fast)',\n     outline: 'none',\n   };\n \n"
                },
                {
                    "date": 1755457304642,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,9 @@\n import { useState, useRef, useEffect } from 'react';\n import { useNavigate } from 'react-router-dom';\n import { search as apiSearch } from '../../lib/api';\n import type { SearchTokenSummary, PoolSummary } from '../../lib/types';\n+import { getChainIcon, getDexIcon } from '../../lib/icons';\n \n interface Props {\n   autoFocus?: boolean;\n   large?: boolean;\n@@ -16,8 +17,10 @@\n   const navigate = useNavigate();\n   const [query, setQuery] = useState('');\n   const [results, setResults] = useState<SearchTokenSummary[]>([]);\n   const [isLoading, setIsLoading] = useState(false);\n+  const [hasError, setHasError] = useState(false);\n+  const [errorMessage, setErrorMessage] = useState('');\n   const timer = useRef<ReturnType<typeof setTimeout> | null>(null);\n   const abortRef = useRef<AbortController | null>(null);\n   const inputRef = useRef<HTMLInputElement>(null);\n \n@@ -30,40 +33,63 @@\n   function runSearch(q: string, force = false) {\n     if (!q || (!force && !isAddress(q) && q.length < 4)) {\n       setResults([]);\n       setIsLoading(false);\n+      setHasError(false);\n+      setErrorMessage('');\n       return;\n     }\n     \n     setIsLoading(true);\n+    setHasError(false);\n+    setErrorMessage('');\n     abortRef.current?.abort();\n     const controller = new AbortController();\n     abortRef.current = controller;\n     \n     apiSearch(q, undefined, controller.signal)\n       .then(({ data }) => {\n         if ('results' in data) {\n-          setResults(Array.isArray(data.results) ? data.results : []);\n+          const searchResults = Array.isArray(data.results) ? data.results : [];\n+          setResults(searchResults);\n+          \n+          if (searchResults.length === 0 && q.length > 0) {\n+            setHasError(true);\n+            setErrorMessage(isAddress(q) ? 'Token address not found' : 'No tokens found matching your search');\n+          }\n         } else {\n           setResults([]);\n+          setHasError(true);\n+          setErrorMessage('Search failed. Please try again.');\n         }\n       })\n-      .catch(() => setResults([]))\n+      .catch((err) => {\n+        if (err.name !== 'AbortError') {\n+          setResults([]);\n+          setHasError(true);\n+          setErrorMessage('Search error. Please check your connection.');\n+        }\n+      })\n       .finally(() => setIsLoading(false));\n   }\n \n   useEffect(() => {\n     if (timer.current) clearTimeout(timer.current);\n+    \n     if (isAddress(query)) {\n       runSearch(query);\n-      return () => {};\n+      return;\n     }\n+    \n     if (query.length >= 4) {\n       timer.current = setTimeout(() => runSearch(query), 500);\n     } else {\n       setResults([]);\n       setIsLoading(false);\n+      setHasError(false);\n+      setErrorMessage('');\n     }\n+    \n     return () => {\n       if (timer.current) clearTimeout(timer.current);\n     };\n   }, [query]);\n@@ -139,30 +165,54 @@\n     <div style={containerStyle}>\n       <label htmlFor=\"global-search\" style={{ position: 'absolute', left: -10000 }}>\n         {'Search tokens or paste address'}\n       </label>\n-      <input\n-        id=\"global-search\"\n-        ref={inputRef}\n-        value={query}\n-        onChange={(e) => setQuery(e.target.value)}\n-        onKeyDown={handleKey}\n-        onPaste={handlePaste}\n-        placeholder=\"Search tokens or paste address\"\n-        aria-label=\"Search tokens or paste address\"\n-        style={{\n-          ...inputStyle,\n-          ...(query ? {\n-            borderColor: 'var(--telegram-blue)',\n-            background: 'var(--bg-elev)',\n-          } : {}),\n-          ...((results.length > 0 || isLoading) ? {\n-            borderRadius: 'var(--radius) var(--radius) 0 0',\n-          } : {})\n-        }}\n-      />\n+      <div className=\"search-input-container\">\n+        <input\n+          id=\"global-search\"\n+          ref={inputRef}\n+          value={query}\n+          onChange={(e) => setQuery(e.target.value)}\n+          onKeyDown={handleKey}\n+          onPaste={handlePaste}\n+          placeholder=\"Search tokens or paste address\"\n+          aria-label=\"Search tokens or paste address\"\n+          className={`search-input-enhanced ${hasError ? 'search-input-error' : ''} ${isLoading ? 'search-loading' : ''}`}\n+          style={{\n+            ...inputStyle,\n+            ...(query ? {\n+              borderColor: hasError ? '#ef4444' : 'var(--telegram-blue)',\n+              background: 'var(--bg-elev)',\n+            } : {}),\n+            ...((results.length > 0 || isLoading || hasError) ? {\n+              borderRadius: 'var(--radius) var(--radius) 0 0',\n+            } : {})\n+          }}\n+        />\n+        <div className=\"search-status-indicator\">\n+          {isLoading && (\n+            <div style={{\n+              width: 16,\n+              height: 16,\n+              border: '2px solid #ddd',\n+              borderTop: '2px solid var(--telegram-blue)',\n+              borderRadius: '50%',\n+              animation: 'spin 1s linear infinite'\n+            }} />\n+          )}\n+          {hasError && !isLoading && (\n+            <span style={{ color: '#ef4444', fontSize: '16px' }}>⚠️</span>\n+          )}\n+        </div>\n+      </div>\n       \n-      {(results.length > 0 || isLoading) && (\n+      {hasError && errorMessage && (\n+        <div className=\"search-error-message\">\n+          {errorMessage}\n+        </div>\n+      )}\n+      \n+      {(results.length > 0 || isLoading) && !hasError && (\n         <div\n           style={{\n             position: 'absolute',\n             top: '100%',\n@@ -173,18 +223,30 @@\n             borderTop: 'none',\n             borderRadius: `0 0 var(--radius) var(--radius)`,\n             boxShadow: 'var(--shadow-medium)',\n             zIndex: 50,\n-            maxHeight: '300px',\n+            maxHeight: '400px',\n             overflow: 'auto',\n           }}\n         >\n           {isLoading ? (\n             <div style={{ \n               padding: 'var(--space-3)', \n               color: 'var(--text-muted)',\n               textAlign: 'center',\n+              display: 'flex',\n+              alignItems: 'center',\n+              justifyContent: 'center',\n+              gap: '8px'\n             }}>\n+              <div style={{\n+                width: 16,\n+                height: 16,\n+                border: '2px solid #ddd',\n+                borderTop: '2px solid var(--telegram-blue)',\n+                borderRadius: '50%',\n+                animation: 'spin 1s linear infinite'\n+              }} />\n               Searching...\n             </div>\n           ) : (\n             results.map((r) => (\n@@ -196,9 +258,9 @@\n                   width: '100%',\n                   textAlign: 'left',\n                   background: 'none',\n                   border: 'none',\n-                  padding: 'var(--space-3)',\n+                  padding: 'var(--space-4)',\n                   color: 'var(--text)',\n                   cursor: 'pointer',\n                   transition: 'background-color var(--transition-fast)',\n                   borderBottom: '1px solid var(--separator)',\n@@ -209,31 +271,88 @@\n                 onMouseLeave={(e) => {\n                   e.currentTarget.style.background = 'none';\n                 }}\n               >\n-                <div style={{ display: 'flex', alignItems: 'center', gap: 'var(--space-2)' }}>\n-                  {r.icon && (\n-                    <img \n-                      src={r.icon} \n-                      alt={`${r.symbol} logo`} \n-                      style={{ width: 24, height: 24, borderRadius: '50%' }} \n-                    />\n-                  )}\n-                  <div style={{ flex: 1 }}>\n-                    <div style={{ fontWeight: 600, marginBottom: '2px' }}>\n-                      {r.symbol}\n+                <div style={{ display: 'flex', alignItems: 'flex-start', gap: 'var(--space-3)' }}>\n+                  <div className=\"token-icon-container\">\n+                    {r.icon ? (\n+                      <img \n+                        src={r.icon} \n+                        alt={`${r.symbol} logo`} \n+                        className=\"token-icon\"\n+                        onError={(e) => {\n+                          e.currentTarget.style.display = 'none';\n+                          const fallback = e.currentTarget.nextElementSibling as HTMLElement;\n+                          if (fallback) fallback.style.display = 'flex';\n+                        }}\n+                      />\n+                    ) : null}\n+                    <div className={`token-fallback ${r.icon ? 'hidden' : ''}`}>\n+                      {r.symbol?.[0]?.toUpperCase()}\n                     </div>\n+                  </div>\n+                  <div style={{ flex: 1, minWidth: 0 }}>\n+                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '4px' }}>\n+                      <span style={{ fontWeight: 600, fontSize: '1rem' }}>\n+                        {r.symbol}\n+                      </span>\n+                      {r.chainIcons && r.chainIcons.length > 0 && (\n+                        <div style={{ display: 'flex', alignItems: 'center', gap: '2px' }}>\n+                          {r.chainIcons.slice(0, 3).map((chain, i) => (\n+                            <img \n+                              key={chain}\n+                              src={getChainIcon(chain)} \n+                              alt={chain}\n+                              style={{ \n+                                width: 16, \n+                                height: 16, \n+                                borderRadius: '50%', \n+                                border: '1px solid var(--border)' \n+                              }}\n+                            />\n+                          ))}\n+                          {r.chainCount && r.chainCount > 3 && (\n+                            <span style={{ fontSize: '0.75rem', color: 'var(--text-muted)', marginLeft: '4px' }}>\n+                              +{r.chainCount - 3}\n+                            </span>\n+                          )}\n+                        </div>\n+                      )}\n+                    </div>\n                     <div style={{ \n                       fontSize: '0.875rem', \n                       color: 'var(--text-muted)',\n+                      marginBottom: '4px',\n+                      overflow: 'hidden',\n+                      textOverflow: 'ellipsis',\n+                      whiteSpace: 'nowrap'\n                     }}>\n                       {r.name}\n                     </div>\n+                    {r.pools && r.pools.length > 0 && (\n+                      <div style={{ \n+                        fontSize: '0.75rem', \n+                        color: 'var(--text-secondary)',\n+                        display: 'flex',\n+                        alignItems: 'center',\n+                        gap: '8px'\n+                      }}>\n+                        <span>{r.pools.length} pool{r.pools.length !== 1 ? 's' : ''}</span>\n+                        {r.liqUsd && (\n+                          <span>• TVL: ${r.liqUsd.toLocaleString()}</span>\n+                        )}\n+                        {r.vol24hUsd && (\n+                          <span>• Vol: ${r.vol24hUsd.toLocaleString()}</span>\n+                        )}\n+                      </div>\n+                    )}\n                   </div>\n                   <div style={{ \n-                    fontSize: '0.875rem', \n-                    color: 'var(--text-secondary)',\n+                    fontSize: '1rem', \n+                    fontWeight: 500,\n+                    color: 'var(--text)',\n                     textAlign: 'right',\n+                    minWidth: '80px'\n                   }}>\n                     ${r.priceUsd?.toFixed(4) || '—'}\n                   </div>\n                 </div>\n"
                },
                {
                    "date": 1755458526289,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,8 +2,9 @@\n import { useNavigate } from 'react-router-dom';\n import { search as apiSearch } from '../../lib/api';\n import type { SearchTokenSummary, PoolSummary } from '../../lib/types';\n import { getChainIcon, getDexIcon } from '../../lib/icons';\n+import { formatUsd, formatCompact } from '../../lib/format';\n \n interface Props {\n   autoFocus?: boolean;\n   large?: boolean;\n@@ -47,13 +48,16 @@\n     abortRef.current = controller;\n     \n     apiSearch(q, undefined, controller.signal)\n       .then(({ data }) => {\n+        if (controller.signal.aborted) return;\n+        \n         if ('results' in data) {\n           const searchResults = Array.isArray(data.results) ? data.results : [];\n           setResults(searchResults);\n           \n-          if (searchResults.length === 0 && q.length > 0) {\n+          // Only show error if this was a forced search (Enter pressed) and no results\n+          if (searchResults.length === 0 && q.length > 0 && force) {\n             setHasError(true);\n             setErrorMessage(isAddress(q) ? 'Token address not found' : 'No tokens found matching your search');\n           }\n         } else {\n@@ -62,15 +66,19 @@\n           setErrorMessage('Search failed. Please try again.');\n         }\n       })\n       .catch((err) => {\n-        if (err.name !== 'AbortError') {\n+        if (err.name !== 'AbortError' && !controller.signal.aborted) {\n           setResults([]);\n           setHasError(true);\n           setErrorMessage('Search error. Please check your connection.');\n         }\n       })\n-      .finally(() => setIsLoading(false));\n+      .finally(() => {\n+        if (!controller.signal.aborted) {\n+          setIsLoading(false);\n+        }\n+      });\n   }\n \n   useEffect(() => {\n     if (timer.current) clearTimeout(timer.current);\n@@ -337,12 +345,12 @@\n                         gap: '8px'\n                       }}>\n                         <span>{r.pools.length} pool{r.pools.length !== 1 ? 's' : ''}</span>\n                         {r.liqUsd && (\n-                          <span>• TVL: ${r.liqUsd.toLocaleString()}</span>\n+                          <span>• TVL: {formatUsd(r.liqUsd, { compact: true })}</span>\n                         )}\n                         {r.vol24hUsd && (\n-                          <span>• Vol: ${r.vol24hUsd.toLocaleString()}</span>\n+                          <span>• Vol: {formatUsd(r.vol24hUsd, { compact: true })}</span>\n                         )}\n                       </div>\n                     )}\n                   </div>\n@@ -350,11 +358,24 @@\n                     fontSize: '1rem', \n                     fontWeight: 500,\n                     color: 'var(--text)',\n                     textAlign: 'right',\n-                    minWidth: '80px'\n+                    minWidth: '100px',\n+                    display: 'flex',\n+                    flexDirection: 'column',\n+                    alignItems: 'flex-end',\n+                    gap: '2px'\n                   }}>\n-                    ${r.priceUsd?.toFixed(4) || '—'}\n+                    <span>{formatUsd(r.priceUsd, { dp: 6 })}</span>\n+                    {r.priceChange24h !== undefined && r.priceChange24h !== 0 && (\n+                      <span style={{\n+                        fontSize: '0.8rem',\n+                        fontWeight: 500,\n+                        color: r.priceChange24h >= 0 ? '#10b981' : '#ef4444'\n+                      }}>\n+                        {r.priceChange24h >= 0 ? '+' : ''}{r.priceChange24h.toFixed(2)}%\n+                      </span>\n+                    )}\n                   </div>\n                 </div>\n               </button>\n             ))\n"
                },
                {
                    "date": 1755517120801,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -240,21 +240,9 @@\n             <div style={{ \n               padding: 'var(--space-3)', \n               color: 'var(--text-muted)',\n               textAlign: 'center',\n-              display: 'flex',\n-              alignItems: 'center',\n-              justifyContent: 'center',\n-              gap: '8px'\n             }}>\n-              <div style={{\n-                width: 16,\n-                height: 16,\n-                border: '2px solid #ddd',\n-                borderTop: '2px solid var(--telegram-blue)',\n-                borderRadius: '50%',\n-                animation: 'spin 1s linear infinite'\n-              }} />\n               Searching...\n             </div>\n           ) : (\n             results.map((r) => (\n@@ -293,10 +281,24 @@\n                           if (fallback) fallback.style.display = 'flex';\n                         }}\n                       />\n                     ) : null}\n-                    <div className={`token-fallback ${r.icon ? 'hidden' : ''}`}>\n-                      {r.symbol?.[0]?.toUpperCase()}\n+                    <div \n+                      className={`token-fallback ${r.icon ? 'hidden' : ''}`}\n+                      style={{\n+                        width: '36px',\n+                        height: '36px',\n+                        borderRadius: '50%',\n+                        display: r.icon ? 'none' : 'flex',\n+                        alignItems: 'center',\n+                        justifyContent: 'center'\n+                      }}\n+                    >\n+                      <img \n+                        src={`https://placehold.co/36x36/909090/ffffff?text=${r.symbol?.[0]?.toUpperCase() || 'T'}`}\n+                        alt={`${r.symbol} placeholder`}\n+                        style={{ width: '36px', height: '36px', borderRadius: '50%' }}\n+                      />\n                     </div>\n                   </div>\n                   <div style={{ flex: 1, minWidth: 0 }}>\n                     <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '4px' }}>\n@@ -324,8 +326,31 @@\n                             </span>\n                           )}\n                         </div>\n                       )}\n+                      {r.pools && (\n+                        <div style={{ display: 'flex', alignItems: 'center', gap: '2px', marginLeft: '4px' }}>\n+                          {Array.from(new Set(r.pools.map(p => p.dex).filter(Boolean))).slice(0, 3).map((dex, i) => (\n+                            <img \n+                              key={dex}\n+                              src={getDexIcon(dex)} \n+                              alt={dex}\n+                              title={dex}\n+                              style={{ \n+                                width: 14, \n+                                height: 14, \n+                                borderRadius: '50%', \n+                                border: '1px solid var(--border)',\n+                                marginLeft: i > 0 ? '-4px' : '0',\n+                                zIndex: 10 - i\n+                              }}\n+                              onError={(e) => {\n+                                e.currentTarget.style.display = 'none';\n+                              }}\n+                            />\n+                          ))}\n+                        </div>\n+                      )}\n                     </div>\n                     <div style={{ \n                       fontSize: '0.875rem', \n                       color: 'var(--text-muted)',\n"
                },
                {
                    "date": 1755522092655,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,7 @@\n import { useState, useRef, useEffect } from 'react';\n import { useNavigate } from 'react-router-dom';\n+import { ContentPaste as PasteIcon } from '@mui/icons-material';\n import { search as apiSearch } from '../../lib/api';\n import type { SearchTokenSummary, PoolSummary } from '../../lib/types';\n import { getChainIcon, getDexIcon } from '../../lib/icons';\n import { formatUsd, formatCompact } from '../../lib/format';\n@@ -121,8 +122,22 @@\n     if (timer.current) clearTimeout(timer.current);\n     runSearch(newValue, true);\n   }\n \n+  async function handlePasteButton() {\n+    try {\n+      const text = await navigator.clipboard.readText();\n+      if (text) {\n+        setQuery(text);\n+        if (timer.current) clearTimeout(timer.current);\n+        runSearch(text, true);\n+        inputRef.current?.focus();\n+      }\n+    } catch (err) {\n+      console.warn('Failed to read clipboard:', err);\n+    }\n+  }\n+\n   function handleSelect(r: SearchTokenSummary) {\n     const pool =\n       r.pools?.find((p) => p.gtSupported) ||\n       [...(r.pools || [])].sort(\n@@ -192,22 +207,38 @@\n               background: 'var(--bg-elev)',\n             } : {}),\n             ...((results.length > 0 || isLoading || hasError) ? {\n               borderRadius: 'var(--radius) var(--radius) 0 0',\n-            } : {})\n+            } : {}),\n+            paddingRight: '50px'\n           }}\n         />\n+        <button\n+          type=\"button\"\n+          onClick={handlePasteButton}\n+          className=\"search-paste-button\"\n+          style={{\n+            position: 'absolute',\n+            right: '12px',\n+            top: '50%',\n+            transform: 'translateY(-50%)',\n+            background: 'none',\n+            border: 'none',\n+            cursor: 'pointer',\n+            color: 'var(--text-muted)',\n+            padding: '4px',\n+            borderRadius: '4px',\n+            display: 'flex',\n+            alignItems: 'center',\n+            justifyContent: 'center',\n+            fontSize: '14px'\n+          }}\n+          aria-label=\"Paste from clipboard\"\n+          title=\"Paste from clipboard\"\n+        >\n+          <PasteIcon fontSize=\"inherit\" />\n+        </button>\n         <div className=\"search-status-indicator\">\n-          {isLoading && (\n-            <div style={{\n-              width: 16,\n-              height: 16,\n-              border: '2px solid #ddd',\n-              borderTop: '2px solid var(--telegram-blue)',\n-              borderRadius: '50%',\n-              animation: 'spin 1s linear infinite'\n-            }} />\n-          )}\n           {hasError && !isLoading && (\n             <span style={{ color: '#ef4444', fontSize: '16px' }}>⚠️</span>\n           )}\n         </div>\n@@ -240,9 +271,21 @@\n             <div style={{ \n               padding: 'var(--space-3)', \n               color: 'var(--text-muted)',\n               textAlign: 'center',\n+              display: 'flex',\n+              alignItems: 'center',\n+              justifyContent: 'center',\n+              gap: '8px'\n             }}>\n+              <div style={{\n+                width: 16,\n+                height: 16,\n+                border: '2px solid #ddd',\n+                borderTop: '2px solid var(--telegram-blue)',\n+                borderRadius: '50%',\n+                animation: 'spin 1s linear infinite'\n+              }} />\n               Searching...\n             </div>\n           ) : (\n             results.map((r) => (\n"
                }
            ],
            "date": 1755347748704,
            "name": "Commit-0",
            "content": "import { useState, useRef, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { search as apiSearch } from '../../lib/api';\nimport type { SearchTokenSummary, PoolSummary } from '../../lib/types';\n\ninterface Props {\n  autoFocus?: boolean;\n  large?: boolean;\n}\n\nfunction isAddress(addr: string) {\n  return /^0x[a-fA-F0-9]{40}$/.test(addr.trim());\n}\n\nexport default function SearchInput({ autoFocus, large }: Props) {\n  const navigate = useNavigate();\n  const [query, setQuery] = useState('');\n  const [results, setResults] = useState<SearchTokenSummary[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const timer = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const abortRef = useRef<AbortController | null>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    if (autoFocus) inputRef.current?.focus();\n  }, [autoFocus]);\n\n  useEffect(() => () => abortRef.current?.abort(), []);\n\n  function runSearch(q: string, force = false) {\n    if (!q || (!force && !isAddress(q) && q.length < 4)) {\n      setResults([]);\n      setIsLoading(false);\n      return;\n    }\n    \n    setIsLoading(true);\n    abortRef.current?.abort();\n    const controller = new AbortController();\n    abortRef.current = controller;\n    \n    apiSearch(q, undefined, controller.signal)\n      .then(({ data }) => {\n        if ('results' in data) {\n          setResults(Array.isArray(data.results) ? data.results : []);\n        } else {\n          setResults([]);\n        }\n      })\n      .catch(() => setResults([]))\n      .finally(() => setIsLoading(false));\n  }\n\n  useEffect(() => {\n    if (timer.current) clearTimeout(timer.current);\n    if (isAddress(query)) {\n      runSearch(query);\n      return () => {};\n    }\n    if (query.length >= 4) {\n      timer.current = setTimeout(() => runSearch(query), 500);\n    } else {\n      setResults([]);\n      setIsLoading(false);\n    }\n    return () => {\n      if (timer.current) clearTimeout(timer.current);\n    };\n  }, [query]);\n\n  function handleKey(e: React.KeyboardEvent<HTMLInputElement>) {\n    if (e.key === 'Enter') {\n      if (timer.current) clearTimeout(timer.current);\n      runSearch(query, true);\n    }\n  }\n\n  function handlePaste(e: React.ClipboardEvent<HTMLInputElement>) {\n    e.preventDefault();\n    const pasted = e.clipboardData.getData('text');\n    const target = e.currentTarget;\n    const start = target.selectionStart ?? 0;\n    const end = target.selectionEnd ?? 0;\n    const value = target.value;\n    const newValue = value.slice(0, start) + pasted + value.slice(end);\n    setQuery(newValue);\n    if (timer.current) clearTimeout(timer.current);\n    runSearch(newValue, true);\n  }\n\n  function handleSelect(r: SearchTokenSummary) {\n    const pool =\n      r.pools?.find((p) => p.gtSupported) ||\n      [...(r.pools || [])].sort(\n        (a: PoolSummary, b: PoolSummary) => (b.liqUsd || 0) - (a.liqUsd || 0)\n      )[0];\n    navigate(\n      `/t/${pool?.chain || ''}/${r.address}/${pool?.pairId || ''}?poolAddress=${\n        pool?.poolAddress || ''\n      }`\n    );\n    setQuery('');\n    setResults([]);\n  }\n\n  const containerStyle = large ? {\n    position: 'relative' as const,\n    width: '100%',\n    maxWidth: 600\n  } : {\n    position: 'relative' as const,\n    width: '100%',\n    maxWidth: 400\n  };\n\n  const inputStyle = large ? {\n    width: '100%',\n    fontSize: '1.125rem',\n    padding: 'var(--space-4)',\n    borderRadius: 'var(--radius-pill)',\n    background: 'var(--bg-input)',\n    border: '1px solid var(--border)',\n    color: 'var(--text)',\n    transition: 'all var(--transition-fast)',\n    outline: 'none',\n  } : {\n    width: '100%',\n    fontSize: '1rem',\n    padding: 'var(--space-3)',\n    borderRadius: 'var(--radius-pill)',\n    background: 'var(--bg-input)',\n    border: '1px solid var(--border)',\n    color: 'var(--text)',\n    transition: 'all var(--transition-fast)',\n    outline: 'none',\n  };\n\n  return (\n    <div style={containerStyle}>\n      <label htmlFor=\"global-search\" style={{ position: 'absolute', left: -10000 }}>\n        {'Search tokens or paste address'}\n      </label>\n      <input\n        id=\"global-search\"\n        ref={inputRef}\n        value={query}\n        onChange={(e) => setQuery(e.target.value)}\n        onKeyDown={handleKey}\n        onPaste={handlePaste}\n        placeholder=\"Search tokens or paste address\"\n        aria-label=\"Search tokens or paste address\"\n        style={{\n          ...inputStyle,\n          ...(query ? {\n            borderColor: 'var(--telegram-blue)',\n            background: 'var(--bg-elev)',\n          } : {}),\n        }}\n      />\n      \n      {(results.length > 0 || isLoading) && (\n        <div\n          style={{\n            position: 'absolute',\n            top: '100%',\n            left: 0,\n            right: 0,\n            background: 'var(--bg-card)',\n            border: '1px solid var(--border)',\n            borderTop: 'none',\n            borderRadius: `0 0 var(--radius) var(--radius)`,\n            boxShadow: 'var(--shadow-medium)',\n            zIndex: 50,\n            maxHeight: '300px',\n            overflow: 'auto',\n          }}\n        >\n          {isLoading ? (\n            <div style={{ \n              padding: 'var(--space-3)', \n              color: 'var(--text-muted)',\n              textAlign: 'center',\n            }}>\n              Searching...\n            </div>\n          ) : (\n            results.map((r) => (\n              <button\n                key={r.address}\n                type=\"button\"\n                onClick={() => handleSelect(r)}\n                style={{\n                  width: '100%',\n                  textAlign: 'left',\n                  background: 'none',\n                  border: 'none',\n                  padding: 'var(--space-3)',\n                  color: 'var(--text)',\n                  cursor: 'pointer',\n                  transition: 'background-color var(--transition-fast)',\n                  borderBottom: '1px solid var(--separator)',\n                }}\n                onMouseEnter={(e) => {\n                  e.currentTarget.style.background = 'var(--hover)';\n                }}\n                onMouseLeave={(e) => {\n                  e.currentTarget.style.background = 'none';\n                }}\n              >\n                <div style={{ display: 'flex', alignItems: 'center', gap: 'var(--space-2)' }}>\n                  {r.icon && (\n                    <img \n                      src={r.icon} \n                      alt={`${r.symbol} logo`} \n                      style={{ width: 24, height: 24, borderRadius: '50%' }} \n                    />\n                  )}\n                  <div style={{ flex: 1 }}>\n                    <div style={{ fontWeight: 600, marginBottom: '2px' }}>\n                      {r.symbol}\n                    </div>\n                    <div style={{ \n                      fontSize: '0.875rem', \n                      color: 'var(--text-muted)',\n                    }}>\n                      {r.name}\n                    </div>\n                  </div>\n                  <div style={{ \n                    fontSize: '0.875rem', \n                    color: 'var(--text-secondary)',\n                    textAlign: 'right',\n                  }}>\n                    ${r.priceUsd?.toFixed(4) || '—'}\n                  </div>\n                </div>\n              </button>\n            ))\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\n"
        }
    ]
}